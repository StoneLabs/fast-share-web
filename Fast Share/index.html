<html>
<head>
    <title>FAST SHARE TEST</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" href="index.html.css">

    <script src="js/jquery-dev.js"></script>
    <script src="js/qrcode.js"></script>
</head>
<body>
    <center>
        <div id="qrcode"></div>
        <pre id="status">PLEASE ENABLE JAVASCRIPT</pre>
    </center>

    <script type="text/javascript">
        var file_key = "UNKNOWN";

        function status(current)
        {
            $("#status").text("STATUS: " + current);
            console.log("STATUS: " + current);
        }

        function setQR(code) //SET QR-CODE
        {
            console.log("QR.CODE: " + code);
            $("#qrcode").html("");
            new QRCode(document.getElementById("qrcode"), code);
        }
        
        function checkStatus()
        {
            $.ajax({
                    type: "POST",
                    url: "/interface/web/getUploadStatus.php",
                    data: { key: file_key },

                    beforeSend: function () {
                        status("checking upload status...");
                    },
                    success: function (html) {
                        var response = JSON.parse(html);
                        if (response.success == false)
                            status("internal error - " + response.error);
                        else
                        {
                            status("received upload status - " + response.data);
                            if (response.data == false)
                            {
                                status("waiting for upload...");
                                setTimeout(checkStatus, 10000);
                            }
                        }
                    },
                    error: function () {
                        status("internal error");
                        return;
                    }
            });
        }

        status("waiting for file id");
        $.ajax({ //Request file id
            type: "POST",
            url: "/interface/web/getID.php",

            success: function (html) {
                var response = JSON.parse(html);
                if (response.success == false)
                    status("internal error - " + response.error);
                else
                {
                    file_key = response.data;

                    setQR(file_key);
                    status("received key - " + file_key);
                    setTimeout(checkStatus, 10000);
                }
            },
            error: function () {
                status("internal error");
                return;
            }
        });
    </script>
</body>
</html>